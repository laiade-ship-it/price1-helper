async function performOCR(input) {
        if (!input.files || !input.files[0]) return;
        const status = document.getElementById('ocr-status');
        status.innerText = "⌛ 辨識中...";
        
        try {
            const r = await Tesseract.recognize(input.files[0], 'chi_tra+jpn+eng');
            const lines = r.data.text.split('\n').map(l => l.trim()).filter(l => l.length > 1);

            // --- 價格處理邏輯 ---
            let finalPrice = "";
            let priceCandidates = [];
            
            lines.forEach(line => {
                const priceMatch = line.match(/([$¥]|NT\$)?\s?(\d{1,3}(,\d{3})*(\.\d+)?|\d+(\.\d+)?)/i);
                if (priceMatch) {
                    let val = parseFloat(priceMatch[0].replace(/[^\d.]/g, ''));
                    let score = 0;
                    if (/[$¥]|NT\$/i.test(line)) score += 100; // 有貨幣符號
                    if (/特價|售價|優惠/i.test(line)) score += 200; // 關鍵字
                    if (/原價|定價/i.test(line)) score += 50; // 原價權重較低
                    if (/編號|No|碼|Tel|日期|202\d|Exp/i.test(line) || val > 10000) score -= 500; // 排除項目
                    
                    priceCandidates.push({ val, score });
                }
            });

            const bestPriceObj = priceCandidates.sort((a,b) => b.score - a.score)[0];
            if (bestPriceObj && bestPriceObj.score > -100) {
                document.getElementById('price').value = bestPriceObj.val;
            }

            // --- 名稱處理邏輯 ---
            const blacklist = ['公司', '產地', '地址', '保存', '日期', '有效', 'Tel', '成分', 'Ingredients'];
            const nameCandidates = lines.map(line => {
                let score = 0;
                const textOnly = line.replace(/[\d\s,.$¥NT:：xX*＊\-/]/g, '');
                const ratio = textOnly.length / line.length;
                
                if (blacklist.some(word => line.includes(word))) score -= 1000; // 黑名單
                if (/[ml|g|入|鮮乳|瓶|包|罐]/i.test(line)) score += 100; // 商品特徵加分
                if (ratio > 0.4) score += (ratio * 50); // 文字密度加分
                
                return { line, score, len: line.length };
            }).filter(item => item.score > 0);

            if (nameCandidates.length > 0) {
                // 取得分最高者，並移除行末純數字或價格
                const bestName = nameCandidates.sort((a,b) => b.score - a.score)[0].line;
                document.getElementById('itemName').value = bestName.replace(/[$¥NT\d,.]+$/g, '').trim();
            }
            
            status.innerText = "✅ 辨識完成";
            calculate(); updateHistory();
        } catch (e) {
            status.innerText = "❌ 辨識失敗";
        }
    }
